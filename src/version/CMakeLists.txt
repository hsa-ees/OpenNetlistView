cmake_minimum_required(VERSION 3.15)

# set the project name
set(VERSION_LIB version)

set(VERSION_SRC
    version.cpp
    )

find_package(Qt6 COMPONENTS Core REQUIRED)

project(${VERSION_LIB}
        LANGUAGES CXX)

include_directories(${CMAKE_SOURCE_DIR}/src)

add_library(${VERSION_LIB} ${VERSION_SRC})

target_link_libraries(${VERSION_LIB} PRIVATE Qt6::Core)


# -----------------------------------------------------------------------------
# Version control file
# A file gen_versionnumber.h is generated by version.cmake, containing information
# regarding the current .git revision.
# This information is embedded into the binary for future reference, ie. for issue
# reporting.
add_custom_target(
    version_file ALL
    # Depend on the dummy file (which is not generated by the versioning script)
    # to ensure that the custom command is executed each time the project is built.
    DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/dummy.cpp
    )

add_dependencies(${VERSION_LIB} version_file)

add_custom_command(
    OUTPUT
        # Dummy file not generated by the sript, but may be used as a dependency
        ${CMAKE_CURRENT_BINARY_DIR}/dummy.cpp
    COMMAND
        ${CMAKE_COMMAND}
            -DDIAGVIEWER_SRC_DIR=${CMAKE_SOURCE_DIR}
            -P ${CMAKE_CURRENT_SOURCE_DIR}/version.cmake)
